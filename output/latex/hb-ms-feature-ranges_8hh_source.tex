\hypertarget{hb-ms-feature-ranges_8hh_source}{}\doxysection{hb-\/ms-\/feature-\/ranges.hh}
\label{hb-ms-feature-ranges_8hh_source}\index{AseSprite/aseprite/third\_party/harfbuzz/src/hb-\/ms-\/feature-\/ranges.hh@{AseSprite/aseprite/third\_party/harfbuzz/src/hb-\/ms-\/feature-\/ranges.hh}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ *\ Copyright\ ©\ 2011,2012,2013\ \ Google,\ Inc.}}
\DoxyCodeLine{00003\ \textcolor{comment}{\ *\ Copyright\ ©\ 2021\ \ Khaled\ Hosny}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ \ This\ is\ part\ of\ HarfBuzz,\ a\ text\ shaping\ library.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ Permission\ is\ hereby\ granted,\ without\ written\ agreement\ and\ without}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ license\ or\ royalty\ fees,\ to\ use,\ copy,\ modify,\ and\ distribute\ this}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ software\ and\ its\ documentation\ for\ any\ purpose,\ provided\ that\ the}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *\ above\ copyright\ notice\ and\ the\ following\ two\ paragraphs\ appear\ in}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ all\ copies\ of\ this\ software.}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ IN\ NO\ EVENT\ SHALL\ THE\ COPYRIGHT\ HOLDER\ BE\ LIABLE\ TO\ ANY\ PARTY\ FOR}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ DIRECT,\ INDIRECT,\ SPECIAL,\ INCIDENTAL,\ OR\ CONSEQUENTIAL\ DAMAGES}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ ARISING\ OUT\ OF\ THE\ USE\ OF\ THIS\ SOFTWARE\ AND\ ITS\ DOCUMENTATION,\ EVEN}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *\ IF\ THE\ COPYRIGHT\ HOLDER\ HAS\ BEEN\ ADVISED\ OF\ THE\ POSSIBILITY\ OF\ SUCH}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ DAMAGE.}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ THE\ COPYRIGHT\ HOLDER\ SPECIFICALLY\ DISCLAIMS\ ANY\ WARRANTIES,\ INCLUDING,}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *\ BUT\ NOT\ LIMITED\ TO,\ THE\ IMPLIED\ WARRANTIES\ OF\ MERCHANTABILITY\ AND}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ THE\ SOFTWARE\ PROVIDED\ HEREUNDER\ IS}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ ON\ AN\ "{}AS\ IS"{}\ BASIS,\ AND\ THE\ COPYRIGHT\ HOLDER\ HAS\ NO\ OBLIGATION\ TO}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *\ PROVIDE\ MAINTENANCE,\ SUPPORT,\ UPDATES,\ ENHANCEMENTS,\ OR\ MODIFICATIONS.}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ Google\ Author(s):\ Behdad\ Esfahbod}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#ifndef\ HB\_MS\_FEATURE\_RANGES\_HH}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#define\ HB\_MS\_FEATURE\_RANGES\_HH}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}hb.hh"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structhb__ms__feature__t}{hb\_ms\_feature\_t}}\ \{}
\DoxyCodeLine{00034\ \ \ uint32\_t\ tag\_le;}
\DoxyCodeLine{00035\ \ \ uint32\_t\ \mbox{\hyperlink{classvalue}{value}};}
\DoxyCodeLine{00036\ \}\ \mbox{\hyperlink{structhb__ms__feature__t}{hb\_ms\_feature\_t}};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structhb__ms__features__t}{hb\_ms\_features\_t}}\ \{}
\DoxyCodeLine{00039\ \ \ \mbox{\hyperlink{structhb__ms__feature__t}{hb\_ms\_feature\_t}}\ *features;}
\DoxyCodeLine{00040\ \ \ uint32\_t\ \ \ \ \ \ \ \ \ num\_features;}
\DoxyCodeLine{00041\ \}\ \mbox{\hyperlink{structhb__ms__features__t}{hb\_ms\_features\_t}};}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\ \{}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{structhb__ms__feature__t}{hb\_ms\_feature\_t}}\ fea;}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order;}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ HB\_INTERNAL\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ cmp\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *pa,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *pb)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ *\mbox{\hyperlink{structa}{a}}\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\ *)\ pa;}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ *b\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\ *)\ pb;}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structa}{a}}-\/>fea.tag\_le\ <\ b-\/>fea.tag\_le\ ?\ -\/1\ :\ \mbox{\hyperlink{structa}{a}}-\/>fea.tag\_le\ >\ b-\/>fea.tag\_le\ ?\ 1\ :}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \mbox{\hyperlink{structa}{a}}-\/>order\ <\ b-\/>order\ ?\ -\/1\ :\ \mbox{\hyperlink{structa}{a}}-\/>order\ >\ b-\/>order\ ?\ 1\ :}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \mbox{\hyperlink{structa}{a}}-\/>fea.value\ <\ b-\/>fea.value\ ?\ -\/1\ :\ \mbox{\hyperlink{structa}{a}}-\/>fea.value\ >\ b-\/>fea.value\ ?\ 1\ :}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ 0;}
\DoxyCodeLine{00054\ \ \ \}}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{bool}\ operator==\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\&\ f)\textcolor{keyword}{\ const}}
\DoxyCodeLine{00056\ \textcolor{keyword}{\ \ }\{\ \textcolor{keywordflow}{return}\ cmp\ (\textcolor{keyword}{this},\ \&f)\ ==\ 0;\ \}}
\DoxyCodeLine{00057\ \};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structhb__ms__feature__event__t}{hb\_ms\_feature\_event\_t}}\ \{}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index;}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordtype}{bool}\ start;}
\DoxyCodeLine{00062\ \ \ \mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\ feature;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ HB\_INTERNAL\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ cmp\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *pa,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *pb)}
\DoxyCodeLine{00065\ \ \ \{}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ *\mbox{\hyperlink{structa}{a}}\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structhb__ms__feature__event__t}{hb\_ms\_feature\_event\_t}}\ *)\ pa;}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ *b\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structhb__ms__feature__event__t}{hb\_ms\_feature\_event\_t}}\ *)\ pb;}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structa}{a}}-\/>index\ <\ b-\/>index\ ?\ -\/1\ :\ \mbox{\hyperlink{structa}{a}}-\/>index\ >\ b-\/>index\ ?\ 1\ :}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \mbox{\hyperlink{structa}{a}}-\/>start\ <\ b-\/>start\ ?\ -\/1\ :\ \mbox{\hyperlink{structa}{a}}-\/>start\ >\ b-\/>start\ ?\ 1\ :}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ hb\_ms\_active\_feature\_t::cmp\ (\&\mbox{\hyperlink{structa}{a}}-\/>feature,\ \&b-\/>feature);}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ \};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structhb__ms__range__record__t}{hb\_ms\_range\_record\_t}}\ \{}
\DoxyCodeLine{00075\ \ \ \mbox{\hyperlink{structhb__ms__features__t}{hb\_ms\_features\_t}}\ features;}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index\_first;\ \textcolor{comment}{/*\ ==\ start\ */}}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index\_last;\ \ \textcolor{comment}{/*\ ==\ end\ -\/\ 1\ */}}
\DoxyCodeLine{00078\ \};}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00081\ hb\_ms\_setup\_features\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{structhb__feature__t}{hb\_feature\_t}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *features,}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ num\_features,}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_feature\_t>}}\ \ \ \ \ \ \&feature\_records,\ \textcolor{comment}{/*\ OUT\ */}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_range\_record\_t>}}\ \&range\_records\ \textcolor{comment}{/*\ OUT\ */})}
\DoxyCodeLine{00085\ \{}
\DoxyCodeLine{00086\ \ \ feature\_records.shrink(0);}
\DoxyCodeLine{00087\ \ \ range\_records.shrink(0);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{/*\ Sort\ features\ by\ start/end\ events.\ */}}
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_feature\_event\_t>}}\ feature\_events;}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_features;\ i++)}
\DoxyCodeLine{00092\ \ \ \{}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\ feature;}
\DoxyCodeLine{00094\ \ \ \ \ feature.fea.tag\_le\ =\ hb\_uint32\_swap\ (features[i].tag);}
\DoxyCodeLine{00095\ \ \ \ \ feature.fea.value\ =\ features[i].value;}
\DoxyCodeLine{00096\ \ \ \ \ feature.order\ =\ i;}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{structhb__ms__feature__event__t}{hb\_ms\_feature\_event\_t}}\ *event;}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{event}\ =\ feature\_events.push\ ();}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{event}-\/>index\ =\ features[i].start;}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keyword}{event}-\/>start\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{event}-\/>feature\ =\ feature;}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{event}\ =\ feature\_events.push\ ();}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keyword}{event}-\/>index\ =\ features[i].end;}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{event}-\/>start\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{event}-\/>feature\ =\ feature;}
\DoxyCodeLine{00109\ \ \ \}}
\DoxyCodeLine{00110\ \ \ feature\_events.qsort\ ();}
\DoxyCodeLine{00111\ \ \ \textcolor{comment}{/*\ Add\ a\ strategic\ final\ event.\ */}}
\DoxyCodeLine{00112\ \ \ \{}
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{structhb__ms__active__feature__t}{hb\_ms\_active\_feature\_t}}\ feature;}
\DoxyCodeLine{00114\ \ \ \ \ feature.fea.tag\_le\ =\ 0;}
\DoxyCodeLine{00115\ \ \ \ \ feature.fea.value\ =\ 0;}
\DoxyCodeLine{00116\ \ \ \ \ feature.order\ =\ num\_features\ +\ 1;}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keyword}{auto}\ *\textcolor{keyword}{event}\ =\ feature\_events.push\ ();}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{event}-\/>index\ =\ 0;\ \textcolor{comment}{/*\ This\ value\ does\ magic.\ */}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keyword}{event}-\/>start\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{event}-\/>feature\ =\ feature;}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{/*\ Scan\ events\ and\ save\ features\ for\ each\ range.\ */}}
\DoxyCodeLine{00125\ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_active\_feature\_t>}}\ active\_features;}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ last\_index\ =\ 0;}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ feature\_events.length;\ i++)}
\DoxyCodeLine{00128\ \ \ \{}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keyword}{auto}\ *\textcolor{keyword}{event}\ =\ \&feature\_events[i];}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordflow}{if}\ (event-\/>index\ !=\ last\_index)}
\DoxyCodeLine{00132\ \ \ \ \ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \textcolor{comment}{/*\ Save\ a\ snapshot\ of\ active\ features\ and\ the\ range.\ */}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ *range\ =\ range\_records.push\ ();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ offset\ =\ feature\_records.length;}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \ \ active\_features.qsort\ ();}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ active\_features.length;\ j++)}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!j\ ||\ active\_features[j].fea.tag\_le\ !=\ feature\_records[feature\_records.length\ -\/\ 1].tag\_le)}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ feature\_records.push\ (active\_features[j].fea);}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Overrides\ value\ for\ existing\ feature.\ */}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ feature\_records[feature\_records.length\ -\/\ 1].value\ =\ active\_features[j].fea.value;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{comment}{/*\ Will\ convert\ to\ pointer\ after\ all\ is\ ready,\ since\ feature\_records.array}}
\DoxyCodeLine{00152\ \textcolor{comment}{\ \ \ \ \ \ \ *\ may\ move\ as\ we\ grow\ it.\ */}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ range-\/>features.features\ =\ \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{structhb__ms__feature__t}{hb\_ms\_feature\_t}}\ *\textcolor{keyword}{>}\ (offset);}
\DoxyCodeLine{00154\ \ \ \ \ \ \ range-\/>features.num\_features\ =\ feature\_records.length\ -\/\ offset;}
\DoxyCodeLine{00155\ \ \ \ \ \ \ range-\/>index\_first\ =\ last\_index;}
\DoxyCodeLine{00156\ \ \ \ \ \ \ range-\/>index\_last\ \ =\ \textcolor{keyword}{event}-\/>index\ -\/\ 1;}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ last\_index\ =\ \textcolor{keyword}{event}-\/>index;}
\DoxyCodeLine{00159\ \ \ \ \ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{if}\ (event-\/>start)}
\DoxyCodeLine{00162\ \ \ \ \ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ active\_features.push\ (event-\/>feature);}
\DoxyCodeLine{00164\ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00166\ \ \ \ \ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ *feature\ =\ active\_features.lsearch\ (event-\/>feature);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (feature)}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ active\_features.remove\ (feature\ -\/\ active\_features.arrayZ);}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{keywordflow}{if}\ (!range\_records.length)\ \textcolor{comment}{/*\ No\ active\ feature\ found.\ */}}
\DoxyCodeLine{00174\ \ \ \ \ num\_features\ =\ 0;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{/*\ Fixup\ the\ pointers.\ */}}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ range\_records.length;\ i++)}
\DoxyCodeLine{00178\ \ \ \{}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keyword}{auto}\ *range\ =\ \&range\_records[i];}
\DoxyCodeLine{00180\ \ \ \ \ range-\/>features.features\ =\ (\mbox{\hyperlink{structhb__ms__feature__t}{hb\_ms\_feature\_t}}\ *)\ feature\_records\ +\ \textcolor{keyword}{reinterpret\_cast<}uintptr\_t\textcolor{keyword}{>}\ (range-\/>features.features);}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{return}\ !!num\_features;}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00187\ hb\_ms\_make\_feature\_ranges\ (\mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_feature\_t>}}\ \ \ \ \ \ \&feature\_records,}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_range\_record\_t>}}\ \&range\_records,}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chars\_offset,}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chars\_len,}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint16\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *log\_clusters,}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<hb\_ms\_features\_t*>}}\ \ \ \ \&range\_features,\ \textcolor{comment}{/*\ OUT\ */}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structhb__vector__t}{hb\_vector\_t<uint32\_t>}}\ \ \ \ \ \ \ \ \ \ \ \ \ \&range\_counts\ \textcolor{comment}{/*\ OUT\ */})}
\DoxyCodeLine{00194\ \{}
\DoxyCodeLine{00195\ \ \ range\_features.shrink\ (0);}
\DoxyCodeLine{00196\ \ \ range\_counts.shrink\ (0);}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \textcolor{keyword}{auto}\ *last\_range\ =\ \&range\_records[0];}
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ chars\_offset;\ i\ <\ chars\_len;\ i++)}
\DoxyCodeLine{00200\ \ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keyword}{auto}\ *range\ =\ last\_range;}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{while}\ (log\_clusters[i]\ <\ range-\/>index\_first)}
\DoxyCodeLine{00203\ \ \ \ \ \ \ range-\/-\/;}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{while}\ (log\_clusters[i]\ >\ range-\/>index\_last)}
\DoxyCodeLine{00205\ \ \ \ \ \ \ range++;}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{if}\ (!range\_features.length\ ||}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \&range-\/>features\ !=\ range\_features[range\_features.length\ -\/\ 1])}
\DoxyCodeLine{00208\ \ \ \ \ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ **features\ =\ range\_features.push\ ();}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ *c\ =\ range\_counts.push\ ();}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unlikely\ (!features\ ||\ !c))}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ range\_features.shrink\ (0);}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ range\_counts.shrink\ (0);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ *features\ =\ \&range-\/>features;}
\DoxyCodeLine{00218\ \ \ \ \ \ \ *c\ =\ 1;}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00221\ \ \ \ \ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ range\_counts[range\_counts.length\ -\/\ 1]++;}
\DoxyCodeLine{00223\ \ \ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ last\_range\ =\ range;}
\DoxyCodeLine{00226\ \ \ \}}
\DoxyCodeLine{00227\ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ HB\_MS\_FEATURE\_RANGES\_HH\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
