\hypertarget{tool__loop__manager_8h_source}{}\doxysection{tool\+\_\+loop\+\_\+manager.\+h}
\label{tool__loop__manager_8h_source}\index{AseSprite/aseprite/src/app/tools/tool\_loop\_manager.h@{AseSprite/aseprite/src/app/tools/tool\_loop\_manager.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Aseprite}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (C)\ 2019-\/2021\ \ Igara\ Studio\ S.A.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Copyright\ (C)\ 2001-\/2017\ \ David\ Capello}}
\DoxyCodeLine{00004\ \textcolor{comment}{//}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ This\ program\ is\ distributed\ under\ the\ terms\ of}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ the\ End-\/User\ License\ Agreement\ for\ Aseprite.}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ APP\_TOOLS\_TOOL\_LOOP\_MANAGER\_H\_INCLUDED}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ APP\_TOOLS\_TOOL\_LOOP\_MANAGER\_H\_INCLUDED}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}app/tools/dynamics.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}app/tools/pointer.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}app/tools/stroke.h"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}doc/brush.h"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}gfx/point.h"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}gfx/region.h"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{namespace\ }gfx\ \{\ \textcolor{keyword}{class\ }Region;\ \}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{namespace\ }app\ \{}
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }tools\ \{}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }ToolLoop;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{comment}{//\ Class\ to\ manage\ the\ drawing\ tool\ (editor\ <-\/>\ tool\ interface).}}
\DoxyCodeLine{00029\ \textcolor{comment}{//}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ The\ flow\ is\ this:}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ 1.\ The\ user\ press\ a\ mouse\ button\ in\ a\ Editor\ widget}}
\DoxyCodeLine{00032\ \textcolor{comment}{//\ 2.\ The\ Editor\ creates\ an\ implementation\ of\ ToolLoop\ and\ use\ it}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ \ \ \ with\ the\ ToolLoopManager\ constructor}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ 3.\ The\ ToolLoopManager\ is\ used\ to\ call}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ \ \ \ the\ following\ methods:}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ \ \ \ -\/\ ToolLoopManager::prepareLoop}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ \ \ \ -\/\ ToolLoopManager::pressButton}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ 4.\ If\ the\ user\ moves\ the\ mouse,\ the\ method}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ \ \ \ -\/\ ToolLoopManager::movement}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ \ \ \ is\ called.}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ 5.\ When\ the\ user\ release\ the\ mouse:}}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ \ \ \ -\/\ ToolLoopManager::releaseButton}}
\DoxyCodeLine{00043\ \textcolor{comment}{//}}
\DoxyCodeLine{00044\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classapp_1_1tools_1_1_tool_loop_manager}{ToolLoopManager}}\ \{}
\DoxyCodeLine{00045\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \textcolor{comment}{//\ Contructs\ a\ manager\ for\ the\ ToolLoop\ delegate.}}
\DoxyCodeLine{00047\ \ \ \mbox{\hyperlink{classapp_1_1tools_1_1_tool_loop_manager}{ToolLoopManager}}(\mbox{\hyperlink{classapp_1_1tools_1_1_tool_loop}{ToolLoop}}*\ toolLoop);}
\DoxyCodeLine{00048\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classapp_1_1tools_1_1_tool_loop_manager}{\string~ToolLoopManager}}();}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ Returns\ true\ if\ the\ loop\ was\ canceled\ by\ the\ user}}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordtype}{bool}\ isCanceled()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ Called\ when\ the\ tool\ loop\ must\ be\ canceled\ because\ another}}
\DoxyCodeLine{00054\ \ \ \textcolor{comment}{//\ command\ was\ executed\ or\ the\ Esc\ key\ pressed.}}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{void}\ cancel();}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{//\ Called\ when\ the\ tool\ loop\ ends\ (this\ will\ commit\ or\ rollback\ the}}
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ tool\ loop).}}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordtype}{void}\ end();}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{//\ Should\ be\ called\ when\ the\ user\ start\ a\ tool-\/trace\ (pressing\ the}}
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ left\ or\ right\ button\ for\ first\ time\ in\ the\ editor).}}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{void}\ prepareLoop(\textcolor{keyword}{const}\ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\&\ pointer);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ Should\ be\ called\ when\ the\ ToolLoop::getModifiers()}}
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ value\ was\ modified\ (e.g.\ when\ the\ user\ press/release\ a\ key).}}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordtype}{void}\ notifyToolLoopModifiersChange();}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{//\ Should\ be\ called\ each\ time\ the\ user\ presses\ a\ mouse\ button.}}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordtype}{void}\ pressButton(\textcolor{keyword}{const}\ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\&\ pointer);}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Should\ be\ called\ each\ time\ the\ user\ releases\ a\ mouse\ button.}}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ Returns\ true\ if\ the\ tool-\/loop\ should\ continue,\ or\ false}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ if\ the\ editor\ should\ release\ the\ mouse\ capture.}}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordtype}{bool}\ releaseButton(\textcolor{keyword}{const}\ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\&\ pointer);}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{comment}{//\ Should\ be\ called\ each\ time\ the\ user\ moves\ the\ mouse\ inside\ the\ editor.}}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordtype}{void}\ movement(\mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\ pointer);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\&\ lastPointer()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ m\_lastPointer;\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00084\ \ \ \textcolor{keywordtype}{void}\ doLoopStep(\textcolor{keywordtype}{bool}\ lastStep);}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordtype}{void}\ snapToGrid(\mbox{\hyperlink{structapp_1_1tools_1_1_stroke_1_1_pt}{Stroke::Pt}}\&\ pt);}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{structapp_1_1tools_1_1_stroke_1_1_pt}{Stroke::Pt}}\ getSpriteStrokePt(\textcolor{keyword}{const}\ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\&\ pointer);}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordtype}{bool}\ useDynamics()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordtype}{void}\ adjustPointWithDynamics(\textcolor{keyword}{const}\ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\&\ pointer,\ \mbox{\hyperlink{structapp_1_1tools_1_1_stroke_1_1_pt}{Stroke::Pt}}\&\ pt);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keywordtype}{void}\ calculateDirtyArea(\textcolor{keyword}{const}\ Strokes\&\ strokes);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \mbox{\hyperlink{classapp_1_1tools_1_1_tool_loop}{ToolLoop}}*\ m\_toolLoop;}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordtype}{bool}\ m\_canceled;}
\DoxyCodeLine{00094\ \ \ \mbox{\hyperlink{classapp_1_1tools_1_1_stroke}{Stroke}}\ m\_stroke;}
\DoxyCodeLine{00095\ \ \ \mbox{\hyperlink{classapp_1_1tools_1_1_pointer}{Pointer}}\ m\_lastPointer;}
\DoxyCodeLine{00096\ \ \ \mbox{\hyperlink{classgfx_1_1_region}{gfx::Region}}\ m\_dirtyArea;}
\DoxyCodeLine{00097\ \ \ \mbox{\hyperlink{classgfx_1_1_region}{gfx::Region}}\ m\_nextDirtyArea;}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{classdoc_1_1_brush}{doc::Brush}}\ m\_brush0;}
\DoxyCodeLine{00099\ \ \ \mbox{\hyperlink{structapp_1_1tools_1_1_dynamics_options}{DynamicsOptions}}\ m\_dynamics;}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{classgfx_1_1_point_t}{gfx::PointF}}\ m\_stabilizerCenter;}
\DoxyCodeLine{00101\ \};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \}\ \textcolor{comment}{//\ namespace\ tools}}
\DoxyCodeLine{00104\ \}\ \textcolor{comment}{//\ namespace\ app}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
