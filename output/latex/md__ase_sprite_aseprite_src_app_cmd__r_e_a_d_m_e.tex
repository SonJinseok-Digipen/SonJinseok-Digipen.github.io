Do not keep {\ttfamily Image\+Ref} or any kind of smart pointer to {\ttfamily doc\+:\+:} entities. As several {\ttfamily cmd} can persist in parallel with other {\ttfamily cmd} (due the tree structure of the \href{../../undo/undo_history.h}{\texttt{ undo history}}) these smart pointers can generate conflicts in the logic layer. E.\+g. If we keep an {\ttfamily Image\+Ref} inside a {\ttfamily cmd}, the image is not removed from the \href{../../doc/object.cpp}{\texttt{ objects hash table}}, so two or more {\ttfamily cmd} could try to add/remove the same object in the hash table (there are asserts to check this state, were someone is trying to add the same {\ttfamily Object\+Id} in the hash table). 