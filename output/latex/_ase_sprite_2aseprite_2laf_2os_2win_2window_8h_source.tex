\hypertarget{_ase_sprite_2aseprite_2laf_2os_2win_2window_8h_source}{}\doxysection{window.\+h}
\label{_ase_sprite_2aseprite_2laf_2os_2win_2window_8h_source}\index{AseSprite/aseprite/laf/os/win/window.h@{AseSprite/aseprite/laf/os/win/window.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ LAF\ OS\ Library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (C)\ 2018-\/2021\ \ Igara\ Studio\ S.A.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Copyright\ (C)\ 2012-\/2018\ \ David\ Capello}}
\DoxyCodeLine{00004\ \textcolor{comment}{//}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ This\ file\ is\ released\ under\ the\ terms\ of\ the\ MIT\ license.}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Read\ LICENSE.txt\ for\ more\ information.}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ OS\_WIN\_WINDOW\_H\_INCLUDED}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ OS\_WIN\_WINDOW\_H\_INCLUDED}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}base/time.h"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}gfx/size.h"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}os/color\_space.h"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}os/event.h"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}os/native\_cursor.h"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}os/pointer\_type.h"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}os/screen.h"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}os/win/wintab.h"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <windows.h>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <interactioncontext.h>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#define\ OS\_USE\_POINTER\_API\_FOR\_MOUSE\ 0}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }os\ \{}
\DoxyCodeLine{00028\ \ \ \textcolor{keyword}{class\ }Surface;}
\DoxyCodeLine{00029\ \ \ \textcolor{keyword}{class\ }SystemWin;}
\DoxyCodeLine{00030\ \ \ \textcolor{keyword}{class\ }WindowSpec;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classos_1_1_window_win}{WindowWin}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classos_1_1_window}{Window}}\ \{}
\DoxyCodeLine{00033\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classos_1_1_window_win}{WindowWin}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classos_1_1_window_spec}{WindowSpec}}\&\ spec);}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classos_1_1_window_win}{\string~WindowWin}}();}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classbase_1_1_ref}{os::ScreenRef}}\ screen()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{classbase_1_1_ref}{os::ColorSpaceRef}}\ colorSpace()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{int}\ scale()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ m\_scale;\ \}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{void}\ setScale(\textcolor{keywordtype}{int}\ scale)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{bool}\ isVisible()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{void}\ setVisible(\textcolor{keywordtype}{bool}\ visible)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{void}\ activate()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{void}\ maximize()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{void}\ minimize()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{bool}\ isMaximized()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keywordtype}{bool}\ isMinimized()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{bool}\ isTransparent()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordtype}{bool}\ isFullscreen()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordtype}{void}\ setFullscreen(\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structstate}{state}})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{classgfx_1_1_size_t}{gfx::Size}}\ clientSize()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classgfx_1_1_rect_t}{gfx::Rect}}\ frame()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{void}\ setFrame(\textcolor{keyword}{const}\ \mbox{\hyperlink{classgfx_1_1_rect_t}{gfx::Rect}}\&\ bounds)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{classgfx_1_1_rect_t}{gfx::Rect}}\ contentRect()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{classgfx_1_1_rect_t}{gfx::Rect}}\ restoredFrame()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00056\ \ \ \ \ std::string\ title()\ \textcolor{keyword}{const\ override};}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{void}\ setTitle(\textcolor{keyword}{const}\ std::string\&\ title)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ captureMouse()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{void}\ releaseMouse()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{void}\ setMousePosition(\textcolor{keyword}{const}\ \mbox{\hyperlink{classgfx_1_1_point_t}{gfx::Point}}\&\ position)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{bool}\ setCursor(NativeCursor\ cursor)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{bool}\ setCursor(\textcolor{keyword}{const}\ \mbox{\hyperlink{classbase_1_1_ref}{CursorRef}}\&\ cursor)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{void}\ performWindowAction(\textcolor{keyword}{const}\ WindowAction\ action,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classos_1_1_event}{Event}}*\ event)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{void}\ invalidateRegion(\textcolor{keyword}{const}\ \mbox{\hyperlink{classgfx_1_1_region}{gfx::Region}}\&\ rgn)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00066\ \ \ \ \ std::string\ getLayout()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{void}\ setLayout(\textcolor{keyword}{const}\ std::string\&\ layout)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{void}\ setTranslateDeadKeys(\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structstate}{state}});}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{void}\ setInterpretOneFingerGestureAsMouseMovement(\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structstate}{state}})\ \textcolor{keyword}{override};}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordtype}{void}\ onTabletAPIChange();}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ NativeHandle\ nativeHandle()\textcolor{keyword}{\ const\ override\ }\{\ \textcolor{keywordflow}{return}\ m\_hwnd;\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordtype}{bool}\ setCursor(HCURSOR\ hcursor,}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classbase_1_1_ref}{CursorRef}}\&\ cursor);}
\DoxyCodeLine{00078\ \ \ \ \ LRESULT\ wndProc(UINT\ msg,\ WPARAM\ wparam,\ LPARAM\ lparam);}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ mouseEvent(LPARAM\ lparam,\ \mbox{\hyperlink{classos_1_1_event}{Event}}\&\ ev);}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{bool}\ pointerEvent(WPARAM\ wparam,\ \mbox{\hyperlink{classos_1_1_event}{Event}}\&\ ev,\ POINTER\_INFO\&\ pi);}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{void}\ handleMouseMove(\mbox{\hyperlink{classos_1_1_event}{Event}}\&\ ev);}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ handleMouseLeave();}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{void}\ handlePointerButtonChange(\mbox{\hyperlink{classos_1_1_event}{Event}}\&\ ev,\ POINTER\_INFO\&\ pi);}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{void}\ handleInteractionContextOutput(}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{keyword}{const}\ INTERACTION\_CONTEXT\_OUTPUT*\ output);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{void}\ waitTimerToConvertFingerAsMouseMovement();}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{void}\ convertFingerAsMouseMovement();}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordtype}{void}\ delegateFingerToInteractionContext();}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{void}\ sendDelayedTouchEvents();}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{void}\ clearDelayedTouchEvents();}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{void}\ killTouchTimer();}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ checkColorSpaceChange();}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordtype}{void}\ openWintabCtx();}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordtype}{void}\ closeWintabCtx();}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ Informs\ the\ taskbar\ that\ we\ are\ going\ (or\ exiting)\ the}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ fullscreen\ mode\ so\ it\ doesn't\ popup\ if\ it's\ hidden.}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordtype}{void}\ notifyFullScreenStateToShell();}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{bool}\ useScrollBarsHack()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ check\ if\ we\ can\ "{}return\ !m\_usePointerApi"{}\ here\ in\ the}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ future\ anyway\ it's\ not\ high-\/priority\ as\ we\ fixed\ the}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ issue\ with\ the\ scrollbar\ grip}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ onResize(\textcolor{keyword}{const}\ \mbox{\hyperlink{classgfx_1_1_size_t}{gfx::Size}}\&\ sz)\ \{\ \}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ onStartResizing()\ \{\ \}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ onEndResizing()\ \{\ \}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ onPaint(HDC\ hdc)\ \{\ \}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ onChangeColorSpace()\ \{\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ registerClass();}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keyword}{static}\ HWND\ createHwnd(\mbox{\hyperlink{classos_1_1_window_win}{WindowWin}}*\ self,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classos_1_1_window_spec}{WindowSpec}}\&\ spec);}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{static}\ LRESULT\ CALLBACK\ staticWndProc(}
\DoxyCodeLine{00118\ \ \ \ \ \ \ HWND\ hwnd,\ UINT\ msg,\ WPARAM\ wparam,\ LPARAM\ lparam);}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ CALLBACK\ staticInteractionContextCallback(}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ clientData,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \textcolor{keyword}{const}\ INTERACTION\_CONTEXT\_OUTPUT*\ output);}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classos_1_1_system_win}{SystemWin}}*\ system();}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keyword}{mutable}\ HWND\ m\_hwnd\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00126\ \ \ \ \ HCURSOR\ m\_hcursor\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{classbase_1_1_ref}{CursorRef}}\ m\_cursor;}
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{classgfx_1_1_size_t}{gfx::Size}}\ m\_clientSize;}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{comment}{//\ Used\ to\ store\ the\ current\ window\ position\ before\ toggling\ on}}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ full-\/screen\ mode.}}
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\#if\ 0}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ TODO\ Restoring\ WINDOWPLACEMENT\ doesn't\ work\ well\ when\ the}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ window\ is\ maximixed.}}
\DoxyCodeLine{00135\ \ \ \ \ WINDOWPLACEMENT\ m\_restoredPlacement;}
\DoxyCodeLine{00136\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{classgfx_1_1_rect_t}{gfx::Rect}}\ m\_restoredFrame;}
\DoxyCodeLine{00138\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{int}\ m\_scale;}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_isCreated;}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Since\ Windows\ Vista,\ it\ looks\ like\ Microsoft\ decided\ to\ change}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ the\ meaning\ of\ the\ window\ position\ to\ the\ shadow\ position\ (when}}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ the\ DWM\ is\ enabled).\ So\ this\ flag\ is\ true\ in\ case\ we\ have\ to}}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ adjust\ the\ real\ position\ we\ want\ to\ put\ the\ window.}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_adjustShadow;}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_translateDeadKeys;}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_hasMouse;}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_captureMouse;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ To\ change\ the\ color\ profile}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keyword}{mutable}\ std::string\ m\_lastICCProfile;}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{classbase_1_1_ref}{os::ColorSpaceRef}}\ m\_lastColorProfile;}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ Windows\ 8\ pointer\ API}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_usePointerApi;}
\DoxyCodeLine{00157\ \ \ \ \ HINTERACTIONCONTEXT\ m\_ictx;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{comment}{//\ This\ might\ be\ the\ most\ ugliest\ hack\ I've\ done\ to\ fix\ a\ Windows}}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ bug.\ Here's\ the\ thing:}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ 1)\ When\ we\ use\ the\ pen\ on\ a\ Surface\ device,\ it\ send\ us}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{comment}{//\ \ \ \ WM\_POINTERUPDATE\ messages,\ but\ after\ a\ WM\_POINTERUPDATE}}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ \ \ \ we'll\ receive\ a\ WM\_MOUSEMOVE\ with\ the\ position\ of\ the\ mouse}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ \ \ \ (which\ is\ different\ to\ the\ position\ of\ the\ pen).\ This}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//\ \ \ \ happens\ constantly\ if\ we\ press\ a\ modifier\ key\ like\ Alt,}}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{//\ \ \ \ Ctrl,\ or\ Shift,\ and\ randomly\ if\ we\ don't\ use\ a\ modifier.}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ 2)\ First\ I\ tried\ to\ fix\ this\ issue\ disabling\ the\ WM\_MOUSEMOVE}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ \ \ \ processing\ when\ a\ pointer\ device\ is\ inside\ the\ window\ (with}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{comment}{//\ \ \ \ WM\_POINTERENTER/LEAVE\ events),\ but\ that\ generated\ some\ buggy}}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{comment}{//\ \ \ \ behavior\ (sometimes\ we\ stopped\ processing\ WM\_MOUSEMOVE}}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{comment}{//\ \ \ \ messages\ completely,\ it\ looks\ like\ a\ WM\_POINTERLEAVE\ could}}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{//\ \ \ \ be\ lost\ in\ time).}}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{comment}{//\ 3)\ Then\ I\ tried\ to\ fix\ this\ using\ the\ Windows\ pointer\ API\ for}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ \ \ \ mouse\ messages\ (EnableMouseInPointer(TRUE))\ but\ that\ API}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{comment}{//\ \ \ \ doesn't\ work\ well\ with\ Wacom\ drivers.\ And\ I\ guess\ it\ might}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ \ \ \ depend\ on\ the\ specific\ driver\ version.}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{comment}{//\ 4)\ Now\ I've\ reverted\ the\ pointer\ API\ change\ (we\ keep\ using\ the}}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{comment}{//\ \ \ \ WM\_MOUSE*\ messages)\ and\ fixed\ the\ original\ issue\ with\ this}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ \ \ \ "{}m\_ignoreRandomMouseEvents"{}\ variable.\ This\ is\ a\ counter\ that}}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{comment}{//\ \ \ \ indicates\ the\ number\ of\ WM\_MOUSEMOVE\ messages\ that\ we\ must}}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//\ \ \ \ ignore\ after\ a\ WM\_POINTERUPDATE.}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{comment}{//\ 5)\ Each\ time\ we\ receive\ a\ WM\_POINTERUPDATE\ this\ counter\ is\ set}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ \ \ \ to\ 2.\ A\ value\ that\ I\ calculated\ practically\ just\ testing\ the}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{//\ \ \ \ pen\ in\ a\ Surface\ Pro\ using\ the\ Alt\ modifier\ and\ seeing\ how}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ \ \ \ many\ random\ WM\_MOUSEMOVE\ messages\ were\ received.}}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ 6)\ When\ a\ WM\_MOUSEMOVE\ is\ received\ this\ counter\ is\ decreased,}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{comment}{//\ \ \ \ so\ when\ it\ backs\ to\ 0\ we\ start\ processing\ WM\_MOUSEMOVE}}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ \ \ \ messages\ again.}}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordtype}{int}\ m\_ignoreRandomMouseEvents;}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ Variables\ used\ to\ convert\ one\ finger\ in\ mouse-\/like\ movement,}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{comment}{//\ and\ two/more\ fingers\ in\ scroll\ movement/pan/zoom.\ The\ idea}}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ is\ as\ follows:}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//\ 1)\ When\ a\ PT\_TOUCH\ is\ received,\ we\ count\ this\ event\ in}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ \ \ \ m\_fingers\ and\ setup\ a\ timer\ (m\_fingerTimerID)\ to\ wait\ for}}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ \ \ \ another\ touch\ event.}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ 2)\ If\ another\ touch\ event\ is\ received,\ we\ process\ the\ messages}}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ \ \ \ with\ the\ interaction\ context\ (m\_ictx)\ to\ handle\ special}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{comment}{//\ \ \ \ gestures\ (pan,\ magnify,\ etc.).}}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ 3)\ If\ the\ timeout\ is\ reached,\ and\ we've\ received\ only\ one}}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ \ \ \ finger\ on\ the\ windows,\ we\ can\ send\ all\ awaiting\ events}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{comment}{//\ \ \ \ (m\_fingerEvents)\ like\ mouse\ movement\ messages/button}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{comment}{//\ \ \ \ presses/releases.}}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keyword}{struct\ }Touch\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ fingers;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Number\ of\ fingers\ in\ the\ window}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \textcolor{comment}{//\ True\ when\ the\ timeout\ wasn't\ reached\ yet\ and\ the\ finger\ can\ be}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \textcolor{comment}{//\ converted\ to\ mouse\ events\ yet.}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ canBeMouse;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \textcolor{comment}{//\ True\ if\ we're\ already\ processing\ finger/touch\ events\ as\ mouse}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \textcolor{comment}{//\ movement\ events.}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ asMouse;}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \textcolor{comment}{//\ Timeout\ (WM\_TIMER)\ when\ the\ finger\ is\ converted\ to\ mouse\ events.}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ UINT\_PTR\ timerID;}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \textcolor{comment}{//\ Queued\ events\ to\ be\ sent\ when\ the\ finger\ is\ converted\ to\ mouse}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \textcolor{comment}{//\ events\ (these\ events\ are\ discarded\ if\ another\ finger\ is}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \textcolor{comment}{//\ introduced\ in\ the\ gesture\ e.g.\ to\ pan)}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ std::vector<Event>\ delayedEvents;}
\DoxyCodeLine{00218\ \ \ \ \ \ \ Touch();}
\DoxyCodeLine{00219\ \ \ \ \ \}\ *m\_touch;}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \textcolor{preprocessor}{\#if\ OS\_USE\_POINTER\_API\_FOR\_MOUSE}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{comment}{//\ Emulate\ double-\/click\ with\ pointer\ API.\ I\ guess\ that\ this\ should}}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{comment}{//\ be\ done\ by\ the\ Interaction\ Context\ API\ but\ it\ looks\ like}}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ messages\ with\ pointerType\ !=\ PT\_TOUCH\ or\ PT\_PEN\ are\ just}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ ignored\ by\ the\ ProcessPointerFramesInteractionContext()}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{comment}{//\ function\ even\ when\ we\ call\ AddPointerInteractionContext()\ with}}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{comment}{//\ the\ given\ PT\_MOUSE\ pointer.}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_emulateDoubleClick;}
\DoxyCodeLine{00229\ \ \ \ \ base::tick\_t\ m\_doubleClickMsecs;}
\DoxyCodeLine{00230\ \ \ \ \ base::tick\_t\ m\_lastPointerDownTime;}
\DoxyCodeLine{00231\ \ \ \ \ Event::MouseButton\ m\_lastPointerDownButton;}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordtype}{int}\ m\_pointerDownCount;}
\DoxyCodeLine{00233\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ Wintab\ API\ data.\ The\ pointer\ type\ \&\ pressure,\ and\ wintab}}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ packets\ queue\ are\ shared\ between\ all\ windows,\ because\ it's}}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{comment}{//\ information\ from\ the\ device\ that\ doesn't\ depend\ on\ the\ active}}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{comment}{//\ window.}}
\DoxyCodeLine{00239\ \ \ \ \ HCTX\ m\_hpenctx;}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keyword}{static}\ PointerType\ m\_pointerType;}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{float}\ m\_pressure;}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keyword}{static}\ std::vector<PACKET>\ m\_packets;}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classos_1_1_event}{Event}}\ m\_lastWintabEvent;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{comment}{//\ Flags}}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_fullscreen;}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_titled;}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_borderless;}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_fixingPos;}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordtype}{bool}\ m\_activate;}
\DoxyCodeLine{00251\ \ \ \};}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \}\ \textcolor{comment}{//\ namespace\ os}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
