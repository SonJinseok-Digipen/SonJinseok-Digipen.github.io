<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Configuring HarfBuzz</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project<span id="projectnumber">&#160;Version 0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Configuring HarfBuzz </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Most of the time you will not need any custom configuration. The configuration options provided by <code>meson</code> should be enough. In particular, if you just want HarfBuzz library plus hb-shape / hb-view utilities, make sure FreeType and Cairo are available and found during configuration.</p>
<p>If you are building for distribution, you should more carefully consider whether you need Glib, ICU, Graphite2, as well as CoreText / Uniscribe / DWrite. Make sure the relevant ones are enabled.</p>
<p>If you are building for custom environment (embedded, downloadable app, etc) where you mostly just want to call <code>hb_shape()</code> and the binary size of the resulting library is very important to you, the rest of this file guides you through your options to disable features you may not need, in exchange for binary size savings.</p>
<h1><a class="anchor" id="autotoc_md1394"></a>
Compiler Options</h1>
<p>Make sure you build with your compiler's "optimize for size" option. On <code>gcc</code> this is <code>-Os</code>, and can be enabled by passing <code>CXXFLAGS=-Os</code>. On clang there is an even more extreme flag, <code>-Oz</code>. Meson also provides <code>--buildtype=minsize</code> for more convenience.</p>
<p>HarfBuzz heavily uses inline functions and the optimize-size flag can make the library smaller by 20% or more. Moreover, sometimes, based on the target CPU, the optimize-size builds perform <em>faster</em> as well, thanks to lower code footprint and caching effects. So, definitely try that even if size is not extremely tight but you have a huge application. For example, Chrome does that. Note that this configuration also automatically enables certain internal optimizations. Search for <code>HB_OPTIMIZE_SIZE</code> for details, if you are using other compilers, or continue reading.</p>
<p>Another compiler option to consider is "link-time optimization", also known as 'lto'. To enable that, feel free to use <code>-Db_lto=true</code> of meson. This, also, can have a huge impact on the final size, 20% or more.</p>
<p>Finally, if you are making a static library build or otherwise linking the library into your app, make sure your linker removes unused functions. This can be tricky and differ from environment to environment, but you definitely want to make sure this happens. Otherwise, every unused public function will be adding unneeded bytes to your binary. The following pointers might come handy:</p>
<ul>
<li><a href="https://lwn.net/Articles/741494/">https://lwn.net/Articles/741494/</a> (all of the four-part series)</li>
<li><a href="https://elinux.org/images/2/2d/ELC2010-gc-sections_Denys_Vlasenko.pdf">https://elinux.org/images/2/2d/ELC2010-gc-sections_Denys_Vlasenko.pdf</a></li>
</ul>
<p>Combining the above three build options should already shrink your library a lot. The rest of this file shows you ways to shrink the library even further at the expense of removing functionality (that may not be needed). The remaining options are all enabled by defining pre-processor macros, which can be done via <code>CXXFLAGS</code> or <code>CPPFLAGS</code> similarly.</p>
<h1><a class="anchor" id="autotoc_md1395"></a>
Unicode-functions</h1>
<p>Access to Unicode data can be configured at compile time as well as run-time. By default, HarfBuzz ships with its own compact subset of properties from Unicode Character Database that it needs. This is a highly-optimized implementation that depending on compile settings (optimize-size or not) takes around ~40kb or ~60kb. Using this implementation (default) is highly recommended, as HarfBuzz always ships with data from latest version of Unicode. This implementation can be disabled by defining <code>HB_NO_UCD</code>.</p>
<p>For example, if you are enabling ICU as a built-in option, or GLib, those can provide Unicode data as well, so defining <code>HB_NO_UCD</code> might save you space without reducing functionality (to the extent that the Unicode version of those implementations is recent.)</p>
<p>If, however, you provide your own Unicode data to HarfBuzz at run-time by calling <code>hb_buffer_set_unicode_funcs</code> on every buffer you create, and you do not rely on <code>hb_unicode_funcs_get_default()</code> results, you can disable the internal implementation by defining both <code>HB_NO_UCD</code> and <code>HB_NO_UNICODE_FUNCS</code>. The latter is needed to guard against accidentally building a library without any default Unicode implementations.</p>
<h1><a class="anchor" id="autotoc_md1396"></a>
Font-functions</h1>
<p>Access to certain font functionalities can also be configured at run-time. By default, HarfBuzz uses an efficient internal implementation of OpenType functionality for this. This internal implementation is called <code>hb-ot-font</code>. All newly-created <code><a class="el" href="structhb__font__t.html">hb_font_t</a></code> objects by default use <code>hb-ot-font</code>. Using this is highly recommended, and is what fonts use by default when they are created.</p>
<p>Most embedded uses will probably use HarfBuzz with FreeType using <code><a class="el" href="hb-ft_8h_source.html">hb-ft.h</a></code>. In that case, or if you otherwise provide those functions by calling <code>hb_font_set_funcs()</code> on every font you create, you can disable <code>hb-ot-font</code> without loss of functionality by defining <code>HB_NO_OT_FONT</code>.</p>
<h1><a class="anchor" id="autotoc_md1397"></a>
Shapers</h1>
<p>Most HarfBuzz clients use it for the main shaper, called "ot". However, it is legitimate to want to compile HarfBuzz with only another backend, eg. CoreText, for example for an iOS app. For that, you want <code>HB_NO_OT_SHAPE</code>. If you are going down that route, check if you want <code>HB_NO_OT</code>.</p>
<p>This is very rarely what you need. Make sure you understand exactly what you are doing.</p>
<p>Defining <code>HB_NO_FALLBACK_SHAPE</code> however is pretty harmless. That removes the (unused) "fallback" shaper.</p>
<h1><a class="anchor" id="autotoc_md1398"></a>
Thread-safety</h1>
<p>By default HarfBuzz builds as a thread-safe library. The exception is that the <code>HB_TINY</code> predefined configuring (more below) disables thread-safety.</p>
<p>If you do <em>not</em> need thread-safety in the library (eg. you always call into HarfBuzz from the same thread), you can disable thread-safety by defining <code>HB_NO_MT</code>. As noted already, this is enabled by <code>HB_TINY</code>.</p>
<h1><a class="anchor" id="autotoc_md1399"></a>
Pre-defined configurations</h1>
<p>The <a href="src/hb-config.hh"><code>hb-config.hh</code></a> internal header supports three pre-defined configurations as well grouping of various configuration options. The pre-defined configurations are:</p>
<ul>
<li><code>HB_MINI</code>: Disables shaping of AAT as well as legacy fonts. Ie. it produces a capable OpenType shaper only.</li>
<li><code>HB_LEAN</code>: Disables various non-shaping functionality in the library, as well as esoteric or rarely-used shaping features. See the definition for details.</li>
<li><code>HB_TINY</code>: Enables both <code>HB_MINI</code> and <code>HB_LEAN</code> configurations, as well as disabling thread-safety and debugging, and use even more size-optimized data tables.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1400"></a>
Tailoring configuration</h1>
<p>Most of the time, one of the pre-defined configuration is exactly what one needs. Sometimes, however, the pre-defined configuration cuts out features that might be desired in the library. Unfortunately there is no quick way to undo those configurations from the command-line.</p>
<p>However, configuration can still be overridden from a file. To do that, add your override instructions (mostly <code>undef</code> instructions) to a header file and define the macro <code>HB_CONFIG_OVERRIDE_H</code> to the string containing to that header file's name. HarfBuzz will then include that file at appropriate right place during configuration.</p>
<p>Up until HarfBuzz 3.1.2 the the configuration override header file's name was fixed and called <code>config-override.h</code>, and was activated by defining the macro <code>HAVE_CONFIG_OVERRIDE_H</code>. That still works.</p>
<h1><a class="anchor" id="autotoc_md1401"></a>
Notes</h1>
<p>Note that the config option <code>HB_NO_CFF</code>, which is enabled by <code>HB_LEAN</code> and <code>HB_TINY</code> does <em>not</em> mean that the resulting library won't work with CFF fonts. The library can shape valid CFF fonts just fine, with or without this option. This option disables (among other things) the code to calculate glyph extents for CFF fonts. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
